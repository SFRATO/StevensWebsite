---
/**
 * TrendIndicator Component
 * Shows a value with up/down/neutral trend indicator
 */

interface Props {
  value: number | null;
  label?: string;
  format?: 'percent' | 'number' | 'currency';
  size?: 'sm' | 'md' | 'lg';
  showArrow?: boolean;
}

const { value, label, format = 'percent', size = 'md', showArrow = true } = Astro.props;

const getTrendClass = (): string => {
  if (value === null) return 'neutral';
  if (value > 0) return 'positive';
  if (value < 0) return 'negative';
  return 'neutral';
};

const formatValue = (): string => {
  if (value === null) return 'N/A';
  const sign = value >= 0 ? '+' : '';

  switch (format) {
    case 'percent':
      return `${sign}${value.toFixed(1)}%`;
    case 'currency':
      return `${sign}$${Math.abs(value).toLocaleString()}`;
    case 'number':
    default:
      return `${sign}${value.toFixed(0)}`;
  }
};

const trendClass = getTrendClass();
---

<span class={`trend-indicator trend-${trendClass} size-${size}`}>
  {showArrow && value !== null && value > 0 && (
    <svg class="trend-arrow" viewBox="0 0 24 24" fill="none">
      <path d="M5 15l7-7 7 7" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  )}
  {showArrow && value !== null && value < 0 && (
    <svg class="trend-arrow" viewBox="0 0 24 24" fill="none">
      <path d="M19 9l-7 7-7-7" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  )}
  <span class="trend-value">{formatValue()}</span>
  {label && <span class="trend-label">{label}</span>}
</span>

<style>
  .trend-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: var(--font-medium);
    border-radius: var(--radius-sm);
  }

  .trend-arrow {
    flex-shrink: 0;
  }

  /* Sizes */
  .size-sm {
    font-size: var(--text-xs);
    padding: 0.125rem 0.375rem;
  }
  .size-sm .trend-arrow {
    width: 10px;
    height: 10px;
  }

  .size-md {
    font-size: var(--text-sm);
    padding: 0.25rem 0.5rem;
  }
  .size-md .trend-arrow {
    width: 12px;
    height: 12px;
  }

  .size-lg {
    font-size: var(--text-base);
    padding: 0.375rem 0.75rem;
  }
  .size-lg .trend-arrow {
    width: 14px;
    height: 14px;
  }

  /* Colors */
  .trend-positive {
    color: var(--accent-green);
    background-color: rgba(76, 175, 80, 0.1);
  }

  .trend-negative {
    color: var(--accent-red);
    background-color: rgba(229, 57, 53, 0.1);
  }

  .trend-neutral {
    color: var(--text-secondary);
    background-color: var(--light-gray);
  }

  .trend-label {
    opacity: 0.8;
    margin-left: 0.25rem;
  }
</style>
